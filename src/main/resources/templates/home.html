<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="layout/base :: layout(~{::section})">

<style>
    .left-card {
        position: relative;
    }

    .card-success-overlay {
        position: absolute;
        inset: 0;

        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(3px);

        display: flex;
        justify-content: center;
        align-items: center;

        border-radius: inherit;
        animation: fadeIn 0.4s ease;
        z-index: 10;
    }

    .success-box {
        text-align: center;
        animation: pop 0.4s ease;
    }

    .success-box .check {
        font-size: 60px;
        margin-bottom: 10px;
    }

    @keyframes shake {
        0%   { transform: translateX(0); }
        25%  { transform: translateX(-5px); }
        50%  { transform: translateX(5px); }
        75%  { transform: translateX(-5px); }
        100% { transform: translateX(0); }
    }

    .answer-textarea.is-invalid {
        animation: shake 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to   { opacity: 1; }
    }

    @keyframes pop {
        from {
            transform: scale(0.7);
            opacity: 0;
        }
        to {
            transform: scale(1);
            opacity: 1;
        }
    }
</style>

<section>
  <div class="row g-4">

    <!-- ì™¼ìª½ ì˜ì—­ -->
    <div class="col-8">
      <div class="card shadow-sm left-card">
        <div class="card-body d-flex flex-column h-100">

          <h4 class="card-title mb-3">ì˜¤ëŠ˜ì˜ ë¬¸ì œ</h4>

          <!-- ì¹´í…Œê³ ë¦¬ -->
          <div class="mb-3">
                        <span class="badge bg-secondary text-white fs-4 px-3 py-2 me-1 fw-bold"
                              th:text="${category}">
                            Spring
                        </span>
          </div>

          <!-- ë¬¸ì œ -->
          <div class="mb-4">
            <div class="position-relative p-3 bg-light rounded fs-4">
                            <span th:text="${question}">
                                ì§ˆë¬¸ í‘œì‹œ ì˜ì—­
                            </span>
            </div>
          </div>

          <!-- ë‹µë³€ í¼ -->
          <form th:action="@{/answer/save}"
                method="post"
                class="flex-grow-1 d-flex flex-column">

            <input type="hidden"
                   name="question"
                   th:value="${question}" />

            <div class="flex-grow-1 d-flex flex-column">

                            <textarea
                              class="form-control answer-textarea flex-grow-1 fs-5"
                              th:classappend="${answerError} != null ? ' is-invalid' : ''"
                              name="content"
                              th:disabled="${completedToday}"
                              placeholder="ì§€ê¸ˆì˜ ì´í•´ë¡œ ìŠ¤íƒì„ ìŒ“ì•„ ë³´ì„¸ìš”."
                              required>
                            </textarea>

              <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
              <div th:if="${answerError}"
                   class="invalid-feedback d-block">
                <span th:text="${answerError}"></span>
              </div>

            </div>

            <div class="mt-4 text-end">
              <button class="btn btn-primary btn-lg px-5"
                      type="submit"
                      th:disabled="${completedToday}">
                ì˜¤ëŠ˜ì˜ ìŠ¤íƒ ìŒ“ê¸° ğŸ§±
              </button>
            </div>

          </form>
        </div>

        <!-- ì™„ë£Œ ì˜¤ë²„ë ˆì´ -->
        <div th:if="${completedToday}" class="card-success-overlay">
          <div class="success-box">
            <div class="check">âœ…</div>
            <h3>ì˜¤ëŠ˜ ìŠ¤íƒ ì™„ë£Œ!</h3>
            <p>Good Job ğŸ‘</p>
          </div>
        </div>

      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
    <div class="col-4">
      <div class="d-flex flex-column gap-4 right-column">

        <!-- ì–´ì œ ê¸°ë¡ -->
        <div class="card shadow-sm flex-grow-1">
          <div class="card-body d-flex flex-column">

            <h5 class="card-title mb-3">ì–´ì œì˜ ê¸°ë¡</h5>

            <div class="mb-3">
              <div class="p-3 bg-light rounded"
                   style="min-height: 4em;">
                <span th:text="${yesterdayQuestion}"></span>
              </div>
            </div>

            <div class="d-flex flex-column flex-grow-1">
              <div class="p-3 bg-light rounded flex-grow-1"
                   style="overflow-y: auto;">
                <span th:text="${yesterdayAnswer}"></span>
              </div>
            </div>

          </div>
        </div>

        <!-- ì§„í–‰ ìƒí™© -->
        <div class="row g-3">

          <div class="col-6">
            <div class="card shadow-sm h-100">
              <div class="card-body">

                <h6 class="fw-bold mb-3">ì§„í–‰ ìƒí™©</h6>

                <div class="d-flex flex-column gap-2">

                  <div class="p-2 bg-light rounded">
                    ğŸ”¥ ì—°ì†
                    <span th:text="${consecutiveDays} ?: 0"
                          class="text-danger fw-bold"></span>ì¼ì°¨
                  </div>

                  <div class="p-2 bg-light rounded">
                    ğŸ“š ì´
                    <span th:text="${totalProblems} ?: 0"
                          class="text-primary fw-bold"></span>ë¬¸ì œ
                  </div>

                </div>
              </div>
            </div>
          </div>

          <!-- ì˜¤ëŠ˜ ìƒíƒœ -->
          <div class="col-6">
            <div class="card shadow-sm h-100">
              <div class="card-body d-flex flex-column">

                <h6 class="fw-bold mb-3">ì˜¤ëŠ˜ì˜ ìƒíƒœ</h6>

                <div class="flex-grow-1 d-flex justify-content-center align-items-center">
                  <div class="px-4 py-3 rounded"
                       th:classappend="${completedToday} ?
                                             ' bg-success bg-opacity-10' :
                                             ' bg-warning bg-opacity-10'">

                                        <span th:text="${completedToday} ?
                                              'âœ… ì™„ë£Œ' :
                                              'ğŸ• ì§„í–‰ ì¤‘'"
                                              class="fw-semibold fs-5"></span>

                  </div>
                </div>

              </div>
            </div>
          </div>

        </div>

      </div>
    </div>

  </div>
</section>

<script th:if="${answerError}">
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelector(".answer-textarea")?.focus();
    });
</script>

</html>